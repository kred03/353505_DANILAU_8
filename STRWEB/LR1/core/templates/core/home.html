{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid px-2 px-md-4">
    <div class="text-center mb-4 mb-md-5">
        <h1 class="display-5 display-md-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∑–æ–æ–ø–∞—Ä–∫!</h1>
        <p class="lead">–£–∑–Ω–∞–π—Ç–µ –≤—Å—ë –æ –Ω–∞—à–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –∏ –∂–∏–∑–Ω–∏ –∑–æ–æ–ø–∞—Ä–∫–∞.</p>
        <div class="current-datetime mb-3 mb-md-4">
            <h3 id="current-time" class="text-primary h4 h-md3"></h3>
            <p id="current-date" class="lead mb-0 small"></p>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-3 mb-md-4 g-2 g-md-4">
        <div class="col-12 col-sm-4 mb-2 mb-sm-0">
            <div class="card text-center h-100 shadow-sm">
                <div class="card-body py-3 py-md-4">
                    <h3 class="card-title h5">–ñ–∏–≤–æ—Ç–Ω—ã—Ö –≤ –∑–æ–æ–ø–∞—Ä–∫–µ</h3>
                    <p class="display-6">{{ animals_count|default:"0" }}</p>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-4 mb-2 mb-sm-0">
            <div class="card text-center h-100 shadow-sm">
                <div class="card-body py-3 py-md-4">
                    <h3 class="card-title h5">–ü–æ–º–µ—â–µ–Ω–∏–π</h3>
                    <p class="display-6">{{ enclosures_count|default:"0" }}</p>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-4">
            <div class="card text-center h-100 shadow-sm">
                <div class="card-body py-3 py-md-4">
                    <h3 class="card-title h5">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                    <p class="display-6">{{ employees_count|default:"0" }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–æ–≤–æ—Å—Ç–∏ -->
    <div class="row mb-4 mb-md-5 g-2 g-md-4">
        <div class="col-12">
            <h2 class="text-center mb-3 mb-md-4 h4 h-md-2">–ù–æ–≤–æ—Å—Ç–∏ –∑–æ–æ–ø–∞—Ä–∫–∞</h2>
        </div>
        {% for news in news %}
        <div class="col-12 col-md-4 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body py-3 py-md-4">
                    <h5 class="card-title h6">{{ news.title }}</h5>
                    <p class="card-text small">{{ news.description|truncatewords:20 }}</p>
                    <a href="{% url 'news-detail' news.pk %}" class="btn btn-outline-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <p class="text-center text-muted">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π</p>
        </div>
        {% endfor %}
    </div>

    <!-- –†–∞–∑–¥–µ–ª—ã –∑–æ–æ–ø–∞—Ä–∫–∞ -->
    <div class="row mb-4 mb-md-5 g-2 g-md-4">
        <div class="col-12">
            <h2 class="text-center mb-3 mb-md-4 h4 h-md-2">–†–∞–∑–¥–µ–ª—ã –∑–æ–æ–ø–∞—Ä–∫–∞</h2>
        </div>
        <div class="col-6 col-md-4 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <span style="font-size: 2rem;">üêæ</span>
                    <h4 class="card-title h6">–ñ–∏–≤–æ—Ç–Ω—ã–µ</h4>
                    <p class="card-text small">–ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –Ω–∞—à–∏–º–∏ –æ–±–∏—Ç–∞—Ç–µ–ª—è–º–∏.</p>
                    <a href="{% url 'animal-list' %}" class="btn btn-outline-primary btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –∂–∏–≤–æ—Ç–Ω—ã—Ö</a>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-4 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <i class="bi bi-building display-6 mb-2 text-primary"></i>
                    <h4 class="card-title h6">–ü–æ–º–µ—â–µ–Ω–∏—è</h4>
                    <p class="card-text small">–£–∑–Ω–∞–π—Ç–µ –æ –≤–æ–ª—å–µ—Ä–∞—Ö –∏ —É—Å–ª–æ–≤–∏—è—Ö —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è.</p>
                    <a href="{% url 'enclosure-list' %}" class="btn btn-outline-primary btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–º–µ—â–µ–Ω–∏—è</a>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-4 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <i class="bi bi-egg-fried display-6 mb-2 text-primary"></i>
                    <h4 class="card-title h6">–ö–æ—Ä–º–ª–µ–Ω–∏—è</h4>
                    <p class="card-text small">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ —É—á–µ—Ç –∫–æ—Ä–º–ª–µ–Ω–∏–π –∂–∏–≤–æ—Ç–Ω—ã—Ö.</p>
                    <a href="{% url 'feeding-list' %}" class="btn btn-outline-primary btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –∫–æ—Ä–º–ª–µ–Ω–∏—è</a>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-4 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <i class="bi bi-person-badge display-6 mb-2 text-primary"></i>
                    <h4 class="card-title h6">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h4>
                    <p class="card-text small">–ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –Ω–∞—à–∏–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏.</p>
                    <a href="{% url 'employee-list' %}" class="btn btn-outline-primary btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</a>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-4 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <i class="bi bi-basket display-6 mb-2 text-primary"></i>
                    <h4 class="card-title h6">–ö–æ—Ä–º–∞</h4>
                    <p class="card-text small">–í–∏–¥—ã –∫–æ—Ä–º–æ–≤ –∏ –∏—Ö —É—á–µ—Ç.</p>
                    <a href="{% url 'feedtype-list' %}" class="btn btn-outline-primary btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –∫–æ—Ä–º–∞</a>
                </div>
            </div>
        </div>
    </div>

    <!-- –ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏ -->
    <div class="row mb-4 mb-md-5 g-2 g-md-4">
        <div class="col-12">
            <h2 class="text-center mb-3 mb-md-4 h4 h-md-2">–ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏</h2>
        </div>
        <div class="col-12 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <i class="bi bi-tags display-6 mb-2 text-success"></i>
                    <h4 class="card-title h6">–î–µ–π—Å—Ç–≤—É—é—â–∏–µ –∞–∫—Ü–∏–∏ –∏ –∫—É–ø–æ–Ω—ã</h4>
                    <p class="card-text small">–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å —Å–∫–∏–¥–∫–∞–º–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –¥–ª—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –∑–æ–æ–ø–∞—Ä–∫–∞.</p>
                    <a href="{% url 'promotion-coupon-list' %}" class="btn btn-outline-success btn-sm">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ü–∏–∏ –∏ –∫—É–ø–æ–Ω—ã</a>
                </div>
            </div>
        </div>
    </div>

    <!-- –í–∞–∫–∞–Ω—Å–∏–∏ –∏ –æ—Ç–∑—ã–≤—ã -->
    <div class="row mb-4 mb-md-5 g-2 g-md-4">
        <div class="col-12 col-md-6 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <i class="bi bi-briefcase display-6 mb-2 text-primary"></i>
                    <h4 class="card-title h6">–í–∞–∫–∞–Ω—Å–∏–∏</h4>
                    <p class="card-text small">–•–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∑–æ–æ–ø–∞—Ä–∫–µ? –û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏.</p>
                    <a href="{% url 'job-list' %}" class="btn btn-outline-primary btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏</a>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 mb-2 mb-md-4">
            <div class="card h-100 shadow">
                <div class="card-body text-center py-3 py-md-4">
                    <i class="bi bi-star display-6 mb-2 text-warning"></i>
                    <h4 class="card-title h6">–û—Ç–∑—ã–≤—ã</h4>
                    <p class="card-text small">–ü–æ—á–∏—Ç–∞–π—Ç–µ –æ—Ç–∑—ã–≤—ã –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π!</p>
                    <a href="{% url 'review-list' %}" class="btn btn-outline-warning btn-sm">–°–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–∑—ã–≤—ã</a>
                </div>
            </div>
        </div>
    </div>

    <!-- –û –∑–æ–æ–ø–∞—Ä–∫–µ -->
    <div class="row mb-4 mb-md-5 g-2 g-md-4">
        <div class="col-12">
            <h2 class="text-center mb-3 mb-md-4 h4 h-md-2">–û –∑–æ–æ–ø–∞—Ä–∫–µ</h2>
            <div class="card shadow">
                <div class="card-body py-3 py-md-4">
                    <p class="lead small">–ù–∞—à –∑–æ–æ–ø–∞—Ä–∫ ‚Äî —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –∑–∞–±–æ—Ç—è—Ç—Å—è –æ –∂–∏–≤–æ—Ç–Ω—ã—Ö, –æ–±—É—á–∞—é—Ç –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –∏ —Å–æ–∑–¥–∞—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ–π —Å–µ–º—å–∏. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∫ –Ω–∞–º –∑–∞ –Ω–æ–≤—ã–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ –∏ —è—Ä–∫–∏–º–∏ —ç–º–æ—Ü–∏—è–º–∏!</p>
                    <a href="{% url 'about' %}" class="btn btn-info btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∑–æ–æ–ø–∞—Ä–∫–µ</a>
                </div>
            </div>
        </div>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
    <div class="row mb-3 mb-md-4 g-2 g-md-4">
        <div class="col-12 col-md-6 mb-2 mb-md-0">
            <div class="card h-100 shadow-sm">
                <div class="card-body py-3 py-md-4">
                    <h3 class="card-title h5">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</h3>
                    <pre class="text-calendar">{{ calendar_text }}</pre>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6">
            <div class="card h-100 shadow-sm">
                <div class="card-body py-3 py-md-4">
                    <h3 class="card-title h5">–§–∞–∫—Ç –æ –∂–∏–≤–æ—Ç–Ω–æ–º</h3>
                    <p id="animal-fact" class="small">{% if animal_fact %}{{ animal_fact }}{% else %}‚Äî{% endif %}</p>
                    <img id="animal-image" src="{% if animal_image %}{{ animal_image }}{% else %}/static/images/animal_placeholder.png{% endif %}" alt="–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –∂–∏–≤–æ—Ç–Ω–æ–≥–æ" class="img-fluid mb-2" style="max-height: 120px;">
                    <h3 class="card-title h5 mt-3 mt-md-4">–ü–æ–≥–æ–¥–∞</h3>
                    <p id="weather" class="small">{% if weather %}{{ weather }}{% else %}‚Äî{% endif %}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    html, body {
        max-width: 100vw;
        overflow-x: hidden;
    }
    .container-fluid {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }
    @media (max-width: 767px) {
        .display-4, .display-5, .display-6, h1, h2, h3, h4, h5 {
            font-size: 1.2rem !important;
        }
        .card-title {
            font-size: 1rem !important;
        }
        .lead {
            font-size: 1rem !important;
        }
        .card-body {
            padding: 0.75rem !important;
        }
    }
</style>

{% block extra_js %}
<script>
// –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
function updateDateTime() {
    const now = new Date();
    const timeOptions = { 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit',
        hour12: false,
        timeZoneName: 'short'
    };
    document.getElementById('current-time').textContent = now.toLocaleTimeString('ru-RU', timeOptions);
    const dateOptions = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric'
    };
    document.getElementById('current-date').textContent = now.toLocaleDateString('ru-RU', dateOptions);
}
setInterval(updateDateTime, 1000);
updateDateTime();

// –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫
function renderCalendar() {
    const calendar = document.getElementById('calendar');
    const now = new Date();
    const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
    const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
    let html = `<div style='text-align:center; font-weight:bold;'>${monthNames[now.getMonth()]} ${now.getFullYear()}</div>`;
    html += '<table class="table table-bordered"><thead><tr>';
    const weekDays = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'];
    for (let d of weekDays) html += `<th>${d}</th>`;
    html += '</tr></thead><tbody><tr>';
    let firstDay = new Date(now.getFullYear(), now.getMonth(), 1).getDay();
    if (firstDay === 0) firstDay = 7;
    for (let i = 1; i < firstDay; i++) html += '<td></td>';
    for (let day = 1; day <= daysInMonth; day++) {
        if ((firstDay + day - 2) % 7 === 0 && day !== 1) html += '</tr><tr>';
        let todayClass = (day === now.getDate()) ? 'bg-primary text-white' : '';
        html += `<td class='${todayClass}'>${day}</td>`;
    }
    html += '</tr></tbody></table>';
    calendar.innerHTML = html;
}
document.addEventListener('DOMContentLoaded', renderCalendar);
</script>
{% endblock %}
{% endblock %} 